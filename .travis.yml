notifications:
  email: false
language: c
cache: ccache

git:
  depth: 1

addons:
  apt:
    packages:
    - ninja-build
    - shellcheck
    - build-essential
# This feature is broken, requires `update: true`, which takes too long (6 minutes)
#  homebrew:
#    update: true
#    packages:
#    - cmake
#    - ninja
#    - ccache
matrix:
  include:
    - name: "Running tests on macOS"
      os: osx
      # Beacause of https://stackoverflow.com/questions/50024731/ld-unrecognized-option-push-state-no-as-needed
      # we don't enable sanitizers on gcc
    - name: "Running tests on GNU/Linux (Ubuntu)"
      os: linux

install:
  - export PATH="/usr/local/opt/ccache/libexec:$PATH"
    # use old-school `brew install` until addons feature is fixed
  - if [[ $TRAVIS_OS_NAME == osx ]] ; then env HOMEBREW_NO_AUTO_UPDATE=1 brew install cmake ninja ccache ; fi

script:
  - 'if shellcheck --version &> /dev/null ; then shellcheck -S style ./test.sh ; fi'
  - mkdir -p build
  - ( pushd build && cmake -G Ninja -DFLTK_IMPORTED=ON .. )
  - ninja -C build all
  - ninja -C build test || true
  - ./test.sh -out
