notifications:
  email: false
language: minimal

git:
  depth: 1

addons:
  apt:
    packages:
    - ninja-build
    - shellcheck
    - build-essential
  homebrew:
    update: true
    packages:
    - cmake
    - ninja
matrix:
  include:
    - name: "Running tests on macOS"
      os: osx
      language: c
      # Beacause of https://stackoverflow.com/questions/50024731/ld-unrecognized-option-push-state-no-as-needed
      # we don't enable sanitizers on gcc
    - name: "Running tests on GNU/Linux (Ubuntu)"
      os: linux

script:
  - 'if shellcheck --version &> /dev/null ; then shellcheck -S style ./test.sh ; fi'
  - mkdir -p build
  - ( pushd build && cmake -G Ninja -DFLTK_IMPORTED=ON .. )
  - ninja -C build all
  - ninja -C build test || true
  - ./test.sh -out
